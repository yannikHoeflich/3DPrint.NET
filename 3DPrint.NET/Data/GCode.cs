namespace _3DPrint.NET.Data;

//https://marlinfw.org/docs/gcode/G029-abl-3point.html
public enum GCode {
    LinearMoveNotPrinting = 0,
    LinearMove = 1,
    ArcMoveClockwise = 2,
    ArcMoveCounterClockwise = 3,
    Dwell = 4,
    BezierCubicSpline = 5,
    DirectStepperMove = 6,
    Retract = 10,
    Recover = 11,
    CleanNozzle = 12,
    SelectPlaneXY = 17,
    SelectPlaneZX = 18,
    SelectPlaneYZ = 19,
    SelectUnitInch = 20,
    SelectUnitMillimeter = 21,
    MeshValidationPattern = 26,
    ParkToolHead = 27,
    AutoHome = 28,
    BedLeveling = 29,
    SingleZProbe = 30,
    DockSled = 31,
    UndockSled = 32,
    DeltaAutoCalibration = 33,
    ZSteppersAutoAlignment = 34,
    TrammingAssistant = 35,
    MoveToMeshCoordinate = 42,
    MoveInMachineCoordinates = 53,
    SaveCurrentPosistion = 60,
    ReturnToSavedPosition = 61,
    ProbeTemperatureCalibration = 76,
    CancelCurrentMotionMode = 80,
    AbsolutePositioning = 90,
    RelativePositioning = 91,
    SetPosition = 92,
    BacklashCalibration = 425,
    UnconditionalStop = 1_000_000,
    CoolantControlsOn = 1_000_007,
    CoolantControlsSpindleFloodCoolant = 1_000_008,
    VaccumOn = 1_000_010,
    VaccumOff = 1_000_011,
    DisableSteppers = 1_000_018,
    SdOrSpiFlash = 1_000_993,
    GCodeMacros = 1_000_810, SpindleCWLaserOn = 1_000_003,
    SpindleCCWLaserOn = 1_000_004,
    SpindleLaserOff = 1_000_005,
    ExpectedPrinterCheck = 1_000_016,
    EnableSteppers = 1_000_017,
    ListSDCard = 1_000_020,
    InitSDCard = 1_000_021,
    ReleaseSDCard = 1_000_022,
    SelectSDFile = 1_000_023,
    StartOrResumeSDPrint = 1_000_024,
    PauseSDPrint = 1_000_025,
    SetSDPosition = 1_000_026,
    ReportSDPrintStatus = 1_000_027,
    StartSDWrite = 1_000_028,
    StopSDWrite = 1_000_029,
    DeleteSDFile = 1_000_030,
    PrintTime = 1_000_031,
    SelectAndStart = 1_000_032,
    GetLongPath = 1_000_033,
    SdcardSorting = 1_000_034,
    SetPinState = 1_000_042,
    DebugPins = 1_000_043,
    ProbeRepeatabilityTest = 1_000_048,
    SetPrintProgress = 1_000_073,
    StartPrintJobTimer = 1_000_075,
    PausePrintJobTimer = 1_000_076,
    StopPrintJobTimer = 1_000_077,
    PrintJobStats = 1_000_078,
    PowerOn = 1_000_080,
    PowerOff = 1_000_081,
    EAbsolute = 1_000_082,
    ERelative = 1_000_083,
    InactivityShutdown = 1_000_085,
    SetAxisStepsPerUnit = 1_000_092,
    FreeMemory = 1_000_100,
    ConfigureBedDistanceSensor = 1_000_102,
    SetHotendTemperature = 1_000_104,
    ReportTemperatures = 1_000_105,
    SetFanSpeed = 1_000_106,
    FanOff = 1_000_107,
    BreakAndContinue = 1_000_108,
    WaitForHotendTemperature = 1_000_109,
    SetLineNumber = 1_000_110,
    DebugLevel = 1_000_111,
    EmergencyStop = 1_000_112,
    HostKeepalive = 1_000_113,
    GetCurrentPosition = 1_000_114,
    FirmwareInfo = 1_000_115,
    SetLCDMessage = 1_000_117,
    SerialPrint = 1_000_118,
    EndstopStates = 1_000_119,
    EnableEndstops = 1_000_120,
    DisableEndstops = 1_000_121,
    TMCDebugging = 1_000_122,
    FanTachometers = 1_000_123,
    ParkHead = 1_000_125,
    Baricuda1Open = 1_000_126,
    Baricuda1Close = 1_000_127,
    Baricuda2Open = 1_000_128,
    Baricuda2Close = 1_000_129,
    SetBedTemperature = 1_000_140,
    SetChamberTemperature = 1_000_141,
    SetLaserCoolerTemperature = 1_000_143,
    SetMaterialPreset = 1_000_145,
    SetTemperatureUnits = 1_000_149,
    SetRGBColor = 1_000_150,
    PositionAutoReport = 1_000_154,
    TemperatureAutoReport = 1_000_155,
    SetMixFactor = 1_000_163,
    SaveMix = 1_000_164,
    SetMix = 1_000_165,
    GradientMix = 1_000_166,
    WaitForBedTemperature = 1_000_190,
    WaitForChamberTemperature = 1_000_191,
    WaitForProbeTemperature = 1_000_192,
    SetLaserCoolerTemperatureAndWait = 1_000_193,
    SetFilamentDiameterVolumetric = 1_000_200,
    PrintMoveLimits = 1_000_201,
    SetMaxFeedrate = 1_000_203,
    SetStartingAcceleration = 1_000_204,
    SetAdvancedSettings = 1_000_205,
    SetHomeOffsets = 1_000_206,
    SetFirmwareRetraction = 1_000_207,
    FirmwareRecover = 1_000_208,
    SetAutoRetract = 1_000_209,
    SoftwareEndstops = 1_000_211,
    FilamentSwapParameters = 1_000_217,
    SetHotendOffset = 1_000_218,
    SetFeedratePercentage = 1_000_220,
    SetFlowPercentage = 1_000_221,
    WaitForPinState = 1_000_226,
    TriggerCamera = 1_000_240,
    LCDContrast = 1_000_250,
    LCDSleepBacklightTimeout = 1_000_255,
    LCDBrightness = 1_000_256,
    I2CSend = 1_000_260,
    I2CRequest = 1_000_261,
    ServoPosition = 1_000_280,
    EditServoAngles = 1_000_281,
    DetachServo = 1_000_282,
    Babystep = 1_000_290,
    PlayTone = 1_000_300,
    SetHotendPID = 1_000_301,
    ColdExtrude = 1_000_302,
    PIDAutotune = 1_000_303,
    SetBedPID = 1_000_304,
    UserThermistorParameters = 1_000_305,
    ModelPredictiveTemperatureControl = 1_000_306,
    SetMicroStepping = 1_000_350,
    SetMicrostepPins = 1_000_351,
    CaseLightControl = 1_000_355,
    SCARAThetaA = 1_000_360,
    SCARAThetaB = 1_000_361,
    SCARAPsiA = 1_000_362,
    SCARAPsiB = 1_000_363,
    SCARAPsiC = 1_000_364,
    ActivateSolenoid = 1_000_380,
    DeactivateSolenoids = 1_000_381,
    FinishMoves = 1_000_400,
    DeployProbe = 1_000_401,
    StowProbe = 1_000_402,
    MMU2FilamentType = 1_000_403,
    SetFilamentDiameter = 1_000_404,
    FilamentWidthSensorOn = 1_000_405,
    FilamentWidthSensorOff = 1_000_406,
    FilamentWidth = 1_000_407,
    Quickstop = 1_000_410,
    FilamentRunout = 1_000_412,
    PowerLossRecovery = 1_000_413,
    BedLevelingState = 1_000_420,
    SetMeshValue = 1_000_421,
    SetZMotorXY = 1_000_422,
    XTwistCompensation = 1_000_423,
    BacklashCompensation = 1_000_425,
    HomeOffsetsHere = 1_000_428,
    PowerMonitor = 1_000_430,
    CancelObjects = 1_000_486,
    SaveSettings = 1_000_500,
    RestoreSettings = 1_000_501,
    FactoryReset = 1_000_502,
    ReportSettings = 1_000_503,
    ValidateEEPROMContents = 1_000_504,
    LockMachine = 1_000_510,
    UnlockMachine = 1_000_511,
    SetPasscode = 1_000_512,
    AbortSDPrint = 1_000_524,
    EndstopsAbortSD = 1_000_540,
    SetTMCSteppingMode = 1_000_569,
    SerialBaudRate = 1_000_575,
    InputShaping = 1_000_593,
    FilamentChange = 1_000_600,
    ConfigureFilamentChange = 1_000_603,
    MultiNozzleMode = 1_000_605,
    DeltaConfiguration = 1_000_665,
    SCARAConfiguration = 1_000_665,
    SetDeltaEndstopAdjustments = 1_000_666,
    SetDualEndstopOffsets = 1_000_666,
    DuetSmartEffectorSensitivity = 1_000_672,
    LoadFilament = 1_000_701,
    UnloadFilament = 1_000_702,
    ControllerFanSettings = 1_000_710,
    RepeatMarker = 1_000_808,
    XYZProbeOffset = 1_000_851,
    BedSkewCompensation = 1_000_852,
    ProbeTemperatureConfig = 1_000_871,
    HandlePromptResponse = 1_000_876,
    LinearAdvanceFactor = 1_000_900,
    StepperMotorCurrent = 1_000_906,
    SetMotorCurrent = 1_000_907,
    SetTrimpotPins = 1_000_908,
    DACPrintValues = 1_000_909,
    CommitDACToEEPROM = 1_000_910,
    TMCOTPreWarnCondition = 1_000_911,
    ClearTMCOTPreWarn = 1_000_912,
    SetHybridThresholdSpeed = 1_000_913,
    TMCBumpSensitivity = 1_000_914,
    TMCZAxisCalibration = 1_000_915,
    L6474ThermalWarningTest = 1_000_916,
    L6474OvercurrentWarningTest = 1_000_917,
    L6474SpeedWarningTest = 1_000_918,
    TMCChopperTiming = 1_000_919,
    StartSDLogging = 1_000_928,
    MagneticParkingExtruder = 1_000_951,
    TouchScreenCalibration = 1_000_995,
    FirmwareUpdate = 1_000_997,
    STOPRestart = 1_000_999,
    MAX7219Control = 1_007_219,

}

public static class GCodes {
    public static GCode Parse(string gCode) {
        if (gCode.Length < 2)
            throw new ArgumentException("Invalid GCode");

        gCode = gCode.ToUpper();

        int code = 0;
        if (gCode[0] == 'M')
            code += 1_000_000;

        code += int.Parse(gCode[1..]);

        return (GCode)code;
    }

    public static string ToGCode(this GCode gCode) {
        int gCodeInt = (int)gCode;
        return gCodeInt >= 1_000_000
            ? $"M{gCodeInt - 1_000_000}"
            : $"G{gCodeInt}";
    }
}